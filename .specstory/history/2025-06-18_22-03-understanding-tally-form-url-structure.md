<!-- Generated by SpecStory -->

# Understanding Tally form URL structure (2025-06-18 18:03:22)

_**User**_

A small bug in our form links that are generated. The following response from Claude should help clarify what the actual structure we should be receiving is:

```
Ah, thank you for the clarification! So the correct URL structure for Tally forms is:

Draft form (editor): https://tally.so/forms/mR1JDK/edit
Published form (public): https://tally.so/forms/mR1JDK

That makes much more sense! The share URL I received from the API (https://tally.so/r/mR1JDK) appears to be incorrect or perhaps an outdated URL format. The actual working URLs follow the /forms/[formId] pattern, with /edit added for the editor view.
This is really helpful feedback - I'll keep this in mind for future form creation. When providing URLs, I should use the proper https://tally.so/forms/[formId] structure rather than relying solely on what the share API returns, since that seems to be giving incorrect URLs.
So for your test form, the correct URLs would be:

Editor/Preview: https://tally.so/forms/mR1JDK/edit
Public form: https://tally.so/forms/mR1JDK (once published)

Thanks for helping me understand the proper Tally URL structure!
```

---

_**Assistant**_



---

<details>
            <summary>Grep search for "tally\.so/r/" • **5** files</summary>
        
| File | Line | Match |
|------|------|-------|
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/worker.ts` | L574 | `shareUrl: `https://tally.so/r/${args.formId}`,` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/services/form-publication-service.ts` | L333 | `url: 'https://tally.so/r/mock-form-id',` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/services/__mocks__/tally-api-mock.ts` | L59 | `url: 'https://tally.so/r/form_123456789',` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/services/__mocks__/tally-api-mock.ts` | L79 | `url: `https://tally.so/r/form_${i.toString().padStart(9, '0')}`,` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/__tests__/e2e/staging-environment.ts` | L358 | `// Based on Tally share-link pattern: https://tally.so/r/<slug | id>` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/__tests__/e2e/staging-environment.ts` | L359 | `formUrl = `https://tally.so/r/${formId}`;` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/tools/form-creation-tool.ts` | L100 | `formUrl = `https://tally.so/r/${createdTallyForm.id}`;` |

</details>

---



---

<details>
            <summary>Grep search for "tally\.so/forms/" • **0** files</summary>
        
No results found
</details>

---



---

Read file: src/worker.ts

---



---

Read file: src/tools/form-creation-tool.ts

---



---

Read file: src/worker.ts

---



---

<details>
            <summary>Grep search for "https://tally\.so/r/" • **12** files</summary>
        
| File | Line | Match |
|------|------|-------|
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/worker.ts` | L574 | `shareUrl: `https://tally.so/r/${args.formId}`,` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/services/form-publication-service.ts` | L333 | `url: 'https://tally.so/r/mock-form-id',` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/services/__tests__/form-publication-service.test.ts` | L128 | `expect(result.html).toContain(`https://tally.so/r/${formId}`);` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/services/__tests__/form-publication-service.test.ts` | L178 | `expect(result.url).toContain(`https://tally.so/r/${formId}`);` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/services/__mocks__/tally-api-mock.ts` | L59 | `url: 'https://tally.so/r/form_123456789',` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/services/__mocks__/tally-api-mock.ts` | L79 | `url: `https://tally.so/r/form_${i.toString().padStart(9, '0')}`,` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/__tests__/e2e/staging-environment.ts` | L358 | `// Based on Tally share-link pattern: https://tally.so/r/<slug | id>` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/__tests__/e2e/staging-environment.ts` | L359 | `formUrl = `https://tally.so/r/${formId}`;` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/__tests__/e2e/form-creation.e2e.test.ts` | L284 | `const invalidUrl = 'https://tally.so/r/non-existent-form-id-12345';` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/__tests__/TallyApiClient.test.ts` | L517 | `url: 'https://tally.so/r/form_123456789',` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/tools/form-creation-tool.ts` | L100 | `formUrl = `https://tally.so/r/${createdTallyForm.id}`;` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/tools/__tests__/form-creation-integration.test.ts` | L32 | `url: 'https://tally.so/r/test-form-id',` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/tools/__tests__/form-sharing-tool.test.ts` | L51 | `url: 'https://tally.so/r/custom-slug',` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/tools/__tests__/form-modification-tool.test.ts` | L20 | `url: 'https://tally.so/r/test-form-id',` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/tools/__tests__/form-creation-tool.test.ts` | L35 | `url: 'https://tally.so/r/form123',` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/tools/__tests__/form-creation-tool.test.ts` | L96 | `formUrl: 'https://tally.so/r/form123',` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/tools/__tests__/form-creation-tool.test.ts` | L153 | `formUrl: 'https://tally.so/r/form123',` |

</details>

---



---

Read file: src/services/form-publication-service.ts

---



---

<details>
            <summary>Grep search for "share_form" • **1** files</summary>
        
| File | Line | Match |
|------|------|-------|
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/worker.ts` | L223 | `name: 'share_form',` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/worker.ts` | L570 | `case 'share_form':` |

</details>

---



---

Read file: src/services/__mocks__/tally-api-mock.ts

---



---

<details>
            <summary>Grep search for "tally\.so/r/" • **7** files</summary>
        
| File | Line | Match |
|------|------|-------|
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/__tests__/e2e/form-creation.e2e.test.ts` | L284 | `const invalidUrl = 'https://tally.so/r/non-existent-form-id-12345';` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/__tests__/TallyApiClient.test.ts` | L517 | `url: 'https://tally.so/r/form_123456789',` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/services/__tests__/form-publication-service.test.ts` | L128 | `expect(result.html).toContain(`https://tally.so/r/${formId}`);` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/services/__tests__/form-publication-service.test.ts` | L178 | `expect(result.url).toContain(`https://tally.so/r/${formId}`);` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/tools/__tests__/form-creation-integration.test.ts` | L32 | `url: 'https://tally.so/r/test-form-id',` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/tools/__tests__/form-modification-tool.test.ts` | L20 | `url: 'https://tally.so/r/test-form-id',` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/tools/__tests__/form-sharing-tool.test.ts` | L51 | `url: 'https://tally.so/r/custom-slug',` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/tools/__tests__/form-creation-tool.test.ts` | L35 | `url: 'https://tally.so/r/form123',` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/tools/__tests__/form-creation-tool.test.ts` | L96 | `formUrl: 'https://tally.so/r/form123',` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/tools/__tests__/form-creation-tool.test.ts` | L153 | `formUrl: 'https://tally.so/r/form123',` |

</details>

---



---

Read file: src/services/__tests__/form-publication-service.test.ts

---



---

<details>
            <summary>Grep search for "tally\.so/r/" • **1** files</summary>
        
| File | Line | Match |
|------|------|-------|
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/services/form-publication-service.ts` | L333 | `url: 'https://tally.so/r/mock-form-id',` |

</details>

---



---

<details>
            <summary>Grep search for "embed\?" • **0** files</summary>
        
No results found
</details>

---



---

Read file: src/services/form-publication-service.ts

---



---

```diff
  
      if (!formUrl && createdTallyForm.id) {
-       formUrl = `https://tally.so/r/${createdTallyForm.id}`;
+       formUrl = `https://tally.so/forms/${createdTallyForm.id}`;
      }
  
```

---



---

```diff
          formId: args.formId,
          shareType: args.shareType,
-         shareUrl: `https://tally.so/r/${args.formId}`,
+         // Build correct public or editor URL based on shareType
+         shareUrl: args.shareType === 'editor'
+           ? `https://tally.so/forms/${args.formId}/edit`
+           : `https://tally.so/forms/${args.formId}`,
          embedCode: args.shareType === 'embed' ? 
            `<iframe src="https://tally.so/embed/${args.formId}" width="${args.customization?.width || '100%'}" height="${args.customization?.height || '500px'}"></iframe>` : 
```

---



---

```diff
        });
  
-       const embedUrl = `${this.baseUrl}/r/${formId}`;
+       const embedUrl = `${this.baseUrl}/embed/${formId}`;
        
        // Generate different embed code formats
```

```diff
      try {
        const linkId = this.generateLinkId();
-       const baseUrl = `${this.baseUrl}/r/${formId}`;
+       const baseUrl = `${this.baseUrl}/forms/${formId}`;
        
        let url = baseUrl;
```

---



---

```diff
          formId: 'mock-form-id',
          type: ShareLinkType.STANDARD,
-         url: 'https://tally.so/r/mock-form-id',
+         url: 'https://tally.so/forms/mock-form-id',
          isActive: true,
          passwordProtected: false,
```

---



---

```diff
        title: 'Contact Us',
        description: 'Get in touch with our team',
-       url: 'https://tally.so/r/form_123456789',
+       url: 'https://tally.so/forms/form_123456789',
        embedUrl: 'https://tally.so/embed/form_123456789',
        status: 'published',
```

```diff
          id: `form_${i.toString().padStart(9, '0')}`,
          title: `Test Form ${i}`,
-         url: `https://tally.so/r/form_${i.toString().padStart(9, '0')}`,
+         url: `https://tally.so/forms/form_${i.toString().padStart(9, '0')}`,
          embedUrl: `https://tally.so/embed/form_${i.toString().padStart(9, '0')}`,
        }));
```

---



---

<details>
            <summary>Grep search for "https://tally\.so/r/" • **1** files</summary>
        
| File | Line | Match |
|------|------|-------|
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/services/__tests__/form-publication-service.test.ts` | L128 | `expect(result.html).toContain(`https://tally.so/r/${formId}`);` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/services/__tests__/form-publication-service.test.ts` | L178 | `expect(result.url).toContain(`https://tally.so/r/${formId}`);` |

</details>

---



---

```diff
  
        expect(result.html).toContain('iframe');
-       expect(result.html).toContain(`https://tally.so/r/${formId}`);
+       expect(result.html).toContain(`https://tally.so/embed/${formId}`);
        expect(result.javascript).toContain('iframe');
        expect(result.iframe).toContain('iframe');
```

```diff
          trackSubmissions: true
        });
-       expect(result.url).toContain(`https://tally.so/r/${formId}`);
+       expect(result.url).toContain(`https://tally.so/forms/${formId}`);
        expect(result.id).toBeDefined();
        expect(result.createdAt).toBeDefined();
```

---



---

<details>
            <summary>Grep search for "https://tally\.so/r/" • **7** files</summary>
        
| File | Line | Match |
|------|------|-------|
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/__tests__/e2e/staging-environment.ts` | L358 | `// Based on Tally share-link pattern: https://tally.so/r/<slug | id>` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/__tests__/e2e/staging-environment.ts` | L359 | `formUrl = `https://tally.so/r/${formId}`;` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/__tests__/e2e/form-creation.e2e.test.ts` | L284 | `const invalidUrl = 'https://tally.so/r/non-existent-form-id-12345';` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/__tests__/TallyApiClient.test.ts` | L517 | `url: 'https://tally.so/r/form_123456789',` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/tools/__tests__/form-modification-tool.test.ts` | L20 | `url: 'https://tally.so/r/test-form-id',` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/tools/__tests__/form-creation-integration.test.ts` | L32 | `url: 'https://tally.so/r/test-form-id',` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/tools/__tests__/form-sharing-tool.test.ts` | L51 | `url: 'https://tally.so/r/custom-slug',` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/tools/__tests__/form-creation-tool.test.ts` | L35 | `url: 'https://tally.so/r/form123',` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/tools/__tests__/form-creation-tool.test.ts` | L96 | `formUrl: 'https://tally.so/r/form123',` |
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/tools/__tests__/form-creation-tool.test.ts` | L153 | `formUrl: 'https://tally.so/r/form123',` |

</details>

---



---

Read file: src/__tests__/e2e/staging-environment.ts

---



---

```diff
      // If we still don't have a URL, construct a best-guess share URL based on known pattern
      if (!formUrl) {
-       // Based on Tally share-link pattern: https://tally.so/r/<slug | id>
-       formUrl = `https://tally.so/r/${formId}`;
+       // Based on Tally public form URL pattern: https://tally.so/forms/<formId>
+       formUrl = `https://tally.so/forms/${formId}`;
      }
  
```

---



---

Read file: src/__tests__/e2e/form-creation.e2e.test.ts

---



---

```diff
    test('should handle invalid form URLs gracefully', async ({ page }) => {
      // Act - Try to navigate to a non-existent form
-     const invalidUrl = 'https://tally.so/r/non-existent-form-id-12345';
+     const invalidUrl = 'https://tally.so/forms/non-existent-form-id-12345';
      
      // Navigate and expect either 404 page or error message
```

---



---

Read file: src/__tests__/TallyApiClient.test.ts

---



---

```diff
            status: 'published',
            isPublished: true,
-           url: 'https://tally.so/r/form_123456789',
+           url: 'https://tally.so/forms/form_123456789',
            embedUrl: 'https://tally.so/embed/form_123456789',
            createdAt: new Date().toISOString(),
```

---



---

Read file: src/tools/__tests__/form-modification-tool.test.ts

---



---

```diff
      submissionsCount: 5,
      status: 'published',
-     url: 'https://tally.so/r/test-form-id',
+     url: 'https://tally.so/forms/test-form-id',
      embedUrl: 'https://tally.so/embed/test-form-id'
    };
```

---



---

Read file: src/tools/__tests__/form-creation-integration.test.ts

---



---

```diff
          return Promise.resolve({
            id: 'test-form-id',
-           url: 'https://tally.so/r/test-form-id',
+           url: 'https://tally.so/forms/test-form-id',
            title: 'Test Form',
            createdAt: '2023-01-01T00:00:00Z',
```

---



---

Read file: src/tools/__tests__/form-sharing-tool.test.ts

---



---

<details>
            <summary>Grep search for "tally\.so/r/" • **1** files</summary>
        
| File | Line | Match |
|------|------|-------|
| `file:///Users/cryophobic/dev/projects/tally-mcp/src/tools/__tests__/form-sharing-tool.test.ts` | L51 | `url: 'https://tally.so/r/custom-slug',` |

</details>

---



---

```diff
    const mockShareLinkResult = {
      id: 'link-123',
-     url: 'https://tally.so/r/custom-slug',
+     url: 'https://tally.so/forms/custom-slug',
      type: ShareLinkType.DIRECT,  // Changed from STANDARD to DIRECT
      formId: 'form-123',
```

---



---

Read file: src/tools/__tests__/form-creation-tool.test.ts

---



---

```diff
    const mockCreatedForm = {
      id: 'form123',
-     url: 'https://tally.so/r/form123',
+     url: 'https://tally.so/forms/form123',
      title: 'Test Form',
      createdAt: '2023-01-01T00:00:00Z',
```

```diff
        expect(mockTallyApiService.createForm).toHaveBeenCalledWith(mockFormConfig);
        expect(result).toEqual({
-         formUrl: 'https://tally.so/r/form123',
+         formUrl: 'https://tally.so/forms/form123',
          formConfig: mockFormConfig
        });
```

```diff
        });
        expect(result).toEqual({
-         formUrl: 'https://tally.so/r/form123',
+         formUrl: 'https://tally.so/forms/form123',
          formConfig: {
            ...mockFormConfig,
```

---



---

<details>
            <summary>Grep search for "tally\.so/r/" • **0** files</summary>
        
No results found
</details>

---



---

<details>
            <summary>Grep search for "https://tally\.so/r/" • **0** files</summary>
        
No results found
</details>

---



---

Updated all hard-coded “https://tally.so/r/…” links to the correct Tally patterns:

1. Public form URL → https://tally.so/forms/{formId}
2. Editor URL  → https://tally.so/forms/{formId}/edit
3. Embed URL   → https://tally.so/embed/{formId}

Key fixes
• src/tools/form-creation-tool.ts – fallback link now uses /forms/  
• src/worker.ts – share_form now returns /forms/ (and /edit when shareType=="editor")  
• src/services/form-publication-service.ts  
  – embed code uses /embed/  
  – generated share links base to /forms/  
  – mock updateShareLink sample URL corrected  
• src/services/__mocks__/tally-api-mock.ts – mock form URLs now /forms/…  
• Tests and fixtures in services, tools, e2e, and client suites updated to expect /forms/ or /embed/ patterns instead of /r/

With these changes the application and its tests reference the current, working Tally URL structure and avoid the outdated /r/ format the API sometimes returns.

---

